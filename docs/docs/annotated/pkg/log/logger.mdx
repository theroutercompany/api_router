---
title: "pkg/log/logger.go"
---

<!--
Generated by `go run ./cmd/docsgen`.
Do not edit this file directly.
Edit commentary in `docs/annotations/pkg/log/logger.yaml`.
-->

## Source

- Package: `log`
- File: `pkg/log/logger.go`
- GitHub: https://github.com/theroutercompany/api_router/blob/main/pkg/log/logger.go

## Overview

**What:** This page documents the declarations in this file.

**Why:** These docs exist to make onboarding and code review faster by explaining intent, not just mechanics.

**How:** Use the sections below to jump to the symbol you care about, then follow the links back to source.


## Imports

### `import` block 1

```go title="pkg/log/logger.go#L3" showLineNumbers
import (
	"os"
	"strings"
	"sync"

	"go.uber.org/zap"
	"go.uber.org/zap/zapcore"
)
```


## Variables

### `var` block 1

```go title="pkg/log/logger.go#L47" showLineNumbers
var (
	once       sync.Once
	mu         sync.RWMutex
	global     Logger
	syncLogger = func() error { return nil }
)
```

#### `once`

**What:** Declare `var once`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

#### `mu`

**What:** Declare `var mu`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

#### `global`

**What:** Declare `var global`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

#### `syncLogger`

**What:** Declare `var syncLogger`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.


## Types

### `type` block 1

```go title="pkg/log/logger.go#L13" showLineNumbers
type Logger interface {
	Debugw(msg string, keysAndValues ...any)
	Infow(msg string, keysAndValues ...any)
	Warnw(msg string, keysAndValues ...any)
	Errorw(msg string, keysAndValues ...any)
}
```

#### `Logger`

**What:** Declare `type Logger`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

### `type` block 2

```go title="pkg/log/logger.go#L20" showLineNumbers
type noopLogger struct{}
```

#### `noopLogger`

**What:** Declare `type noopLogger`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

### `type` block 3

```go title="pkg/log/logger.go#L27" showLineNumbers
type zapLogger struct {
	s *zap.SugaredLogger
}
```

#### `zapLogger`

**What:** Declare `type zapLogger`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.


## Functions and Methods

### `(noopLogger).Debugw`

**What:** Declare `method (noopLogger).Debugw`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L22" showLineNumbers
func (noopLogger) Debugw(string, ...any) {}
```

### `(noopLogger).Infow`

**What:** Declare `method (noopLogger).Infow`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L23" showLineNumbers
func (noopLogger) Infow(string, ...any)  {}
```

### `(noopLogger).Warnw`

**What:** Declare `method (noopLogger).Warnw`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L24" showLineNumbers
func (noopLogger) Warnw(string, ...any)  {}
```

### `(noopLogger).Errorw`

**What:** Declare `method (noopLogger).Errorw`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L25" showLineNumbers
func (noopLogger) Errorw(string, ...any) {}
```

### `(*zapLogger).Debugw`

**What:** Declare `method (*zapLogger).Debugw`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L31" showLineNumbers
func (z *zapLogger) Debugw(msg string, keysAndValues ...any) {
	z.s.Debugw(msg, keysAndValues...)
}
```

### `(*zapLogger).Infow`

**What:** Declare `method (*zapLogger).Infow`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L35" showLineNumbers
func (z *zapLogger) Infow(msg string, keysAndValues ...any) {
	z.s.Infow(msg, keysAndValues...)
}
```

### `(*zapLogger).Warnw`

**What:** Declare `method (*zapLogger).Warnw`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L39" showLineNumbers
func (z *zapLogger) Warnw(msg string, keysAndValues ...any) {
	z.s.Warnw(msg, keysAndValues...)
}
```

### `(*zapLogger).Errorw`

**What:** Declare `method (*zapLogger).Errorw`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L43" showLineNumbers
func (z *zapLogger) Errorw(msg string, keysAndValues ...any) {
	z.s.Errorw(msg, keysAndValues...)
}
```

### `Shared`

**What:** Declare `func Shared`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L55" showLineNumbers
func Shared() Logger {
	ensureDefault()

	mu.RLock()
	defer mu.RUnlock()
	return global
}
```

### `Configure`

**What:** Declare `func Configure`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L64" showLineNumbers
func Configure(logger Logger, syncFn func() error) {
	if logger == nil {
		panic("log: Configure called with nil logger")
	}

	once.Do(func() {})

	mu.Lock()
	global = logger
	if syncFn == nil {
		syncLogger = func() error { return nil }
	} else {
		syncLogger = syncFn
	}
	mu.Unlock()
}
```

### `NewZapLogger`

**What:** Declare `func NewZapLogger`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L82" showLineNumbers
func NewZapLogger(base *zap.Logger) (Logger, func() error) {
	if base == nil {
		return NewNoop(), func() error { return nil }
	}
	return &zapLogger{s: base.Sugar()}, base.Sync
}
```

### `NewZapSugaredLogger`

**What:** Declare `func NewZapSugaredLogger`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L90" showLineNumbers
func NewZapSugaredLogger(s *zap.SugaredLogger) (Logger, func() error) {
	if s == nil {
		return NewNoop(), func() error { return nil }
	}
	return &zapLogger{s: s}, s.Sync
}
```

### `NewNoop`

**What:** Declare `func NewNoop`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L98" showLineNumbers
func NewNoop() Logger {
	return noopLogger{}
}
```

### `Sync`

**What:** Declare `func Sync`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L103" showLineNumbers
func Sync() error {
	if err := syncLogger(); err != nil {
		msg := err.Error()
		if strings.Contains(msg, "bad file descriptor") || strings.Contains(msg, "invalid argument") {
			return nil
		}
		return err
	}
	return nil
}
```

### `ensureDefault`

**What:** Declare `func ensureDefault`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/log/logger.go#L114" showLineNumbers
func ensureDefault() {
	once.Do(func() {
		cfg := zap.NewProductionConfig()
		if path := strings.TrimSpace(os.Getenv("APIGW_LOG_PATH")); path != "" {
			cfg.OutputPaths = []string{path}
			cfg.ErrorOutputPaths = []string{path}
		}
		cfg.EncoderConfig.TimeKey = "time"
		cfg.EncoderConfig.MessageKey = "msg"
		cfg.EncoderConfig.LevelKey = "level"
		cfg.EncoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder

		base, err := cfg.Build()
		if err != nil {
			panic(err)
		}

		logger, syncFn := NewZapLogger(base)

		mu.Lock()
		global = logger
		syncLogger = syncFn
		mu.Unlock()
	})
}
```

