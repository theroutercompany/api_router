---
title: "pkg/gateway/metrics/registry.go"
---

<!--
Generated by `go run ./cmd/docsgen`.
Do not edit this file directly.
Edit commentary in `docs/annotations/pkg/gateway/metrics/registry.yaml`.
-->

## Source

- Package: `metrics`
- File: `pkg/gateway/metrics/registry.go`
- GitHub: https://github.com/theroutercompany/api_router/blob/main/pkg/gateway/metrics/registry.go

## Overview

**What:** This page documents the declarations in this file.

**Why:** These docs exist to make onboarding and code review faster by explaining intent, not just mechanics.

**How:** Use the sections below to jump to the symbol you care about, then follow the links back to source.


## Imports

### `import` block 1

```go title="pkg/gateway/metrics/registry.go#L3" showLineNumbers
import (
	"net/http"
	"strings"

	"github.com/prometheus/client_golang/prometheus"
	"github.com/prometheus/client_golang/prometheus/collectors"
	"github.com/prometheus/client_golang/prometheus/promhttp"
)
```


## Types

### `type` block 1

```go title="pkg/gateway/metrics/registry.go#L13" showLineNumbers
type Option func(*options)
```

#### `Option`

**What:** Declare `type Option`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

### `type` block 2

```go title="pkg/gateway/metrics/registry.go#L15" showLineNumbers
type options struct {
	namespace                 string
	registerDefaultCollectors bool
}
```

#### `options`

**What:** Declare `type options`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

### `type` block 3

```go title="pkg/gateway/metrics/registry.go#L39" showLineNumbers
type Registry struct {
	namespace string
	registry  *prometheus.Registry
}
```

#### `Registry`

**What:** Declare `type Registry`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.


## Functions and Methods

### `WithNamespace`

**What:** Declare `func WithNamespace`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/gateway/metrics/registry.go#L23" showLineNumbers
func WithNamespace(namespace string) Option {
	return func(o *options) {
		o.namespace = strings.TrimSpace(namespace)
	}
}
```

### `WithoutDefaultCollectors`

**What:** Declare `func WithoutDefaultCollectors`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/gateway/metrics/registry.go#L31" showLineNumbers
func WithoutDefaultCollectors() Option {
	return func(o *options) {
		o.registerDefaultCollectors = false
	}
}
```

### `NewRegistry`

**What:** Declare `func NewRegistry`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/gateway/metrics/registry.go#L46" showLineNumbers
func NewRegistry(opts ...Option) *Registry {
	settings := options{
		registerDefaultCollectors: true,
	}
	for _, opt := range opts {
		if opt != nil {
			opt(&settings)
		}
	}

	reg := prometheus.NewRegistry()
	if settings.registerDefaultCollectors {
		reg.MustRegister(collectors.NewGoCollector())
		reg.MustRegister(collectors.NewProcessCollector(collectors.ProcessCollectorOpts{}))
	}

	return &Registry{
		namespace: settings.namespace,
		registry:  reg,
	}
}
```

### `(*Registry).Namespace`

**What:** Declare `method (*Registry).Namespace`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/gateway/metrics/registry.go#L69" showLineNumbers
func (r *Registry) Namespace() string {
	if r == nil {
		return ""
	}
	return r.namespace
}
```

### `(*Registry).Handler`

**What:** Declare `method (*Registry).Handler`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/gateway/metrics/registry.go#L78" showLineNumbers
func (r *Registry) Handler() http.Handler {
	if r == nil || r.registry == nil {
		return http.NotFoundHandler()
	}
	return promhttp.HandlerFor(r.registry, promhttp.HandlerOpts{})
}
```

### `(*Registry).Register`

**What:** Declare `method (*Registry).Register`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/gateway/metrics/registry.go#L88" showLineNumbers
func (r *Registry) Register(c prometheus.Collector) {
	if r == nil || r.registry == nil || c == nil {
		return
	}
	r.registry.MustRegister(c)
}
```

### `(*Registry).Raw`

**What:** Declare `method (*Registry).Raw`.

**Why:** Centralizes behavior and avoids duplication in call sites.

**How:** See the Go snippet and the source link for behavior and usage.

```go title="pkg/gateway/metrics/registry.go#L96" showLineNumbers
func (r *Registry) Raw() *prometheus.Registry {
	if r == nil {
		return nil
	}
	return r.registry
}
```

